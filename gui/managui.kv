#:import la kivy.adapters.simplelistadapter
#:import ChatLog gui.chatlog.ChatLog
#:import ChatLogItem gui.chatlog.ChatLogItem
#:import deque collections.deque
#:import MyListView gui.chatlog.MyListView


<PlayersListItem>:

    canvas.before:
        Color:
            rgba: 0.05, 0.05, 0.05, 1
        Line:
            points:  [ self.x, self.y, self.x+self.width, self.y ]

    Label:
        text: root.nick


<PlayersList>:

    canvas.before:
        Color:
            rgba: .25, .1, .9, 1
        Rectangle:
            pos: self.pos
            size: self.size


<RootWidget>:
    mobile: True if self.width < dp(600) else False

    canvas.before:
        Color:
            rgba: 0.01, 0.33, 0.32, 1
        Rectangle:
            pos: self.pos
            size: self.size

    messages_log: id_chat_log
    chat_input: id_chat_input
    players_list: id_players_list

    BoxLayout:
        orientation: 'horizontal'
        size_hint: 1, 1

        BoxLayout:
            orientation: 'vertical'
            size_hint: 1, 1

            ChatLog:
                id: id_chat_log

            TextInput:
                id: id_chat_input
                size_hint_y: None
                height: '50dp'
                focus: True
                multiline: False
                on_text_validate: root.on_command_enter(args)

        PlayersList:
            id: id_players_list
            size_hint: None, 1
            width: '150dp'


<ChatLogItem>:

    canvas.before:
        Color:
            rgba: self.background_color
        Rectangle:
            pos: self.pos
            size: self.size

    # orientation: 'vertical'
    cols: 1        
    size_hint: None, None
    height: lbl_message.height

    Label:
        id: lbl_message
        text: root.message
        text_size: self.width, None
        size_hint: None, None
        width: root.width
        height: self.texture_size[1] + 10
        # height: '25dp'
        markup: True
        on_ref_press: app.open_link(args[1])


[ChatLogItemT@Label]:
    # size_hint_y: None
    text_size: self.width, None
    height: self.texture_size[1] + 10    


<ChatLog>:
    cols: 1
    msg_list: msg_list
    
    MyListView:
        id: msg_list
        adapter:
            la.SimpleListAdapter(data=['Welcome to [ref=https://bitbucket.org/rumly111/manachat/][color=0000ff]ManaChat[/color][/ref]. Press F1 to show settings.', 'aa bbb cccc' * 1],
            cls=ChatLogItem,
            args_converter=root.msg_converter)
